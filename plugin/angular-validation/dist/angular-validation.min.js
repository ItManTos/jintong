(function(){angular.module("validation",["validation.provider","validation.directive"])}).call(this),function(){angular.module("validation.provider",[]).provider("$validation",function(){var e,t,i,n,s,r=this,a=function(r){e=r,t=e.get("$rootScope"),i=e.get("$http"),n=e.get("$q"),s=e.get("$timeout")},o={},l={};this.setExpression=function(e){return angular.extend(o,e),r},this.getExpression=function(e){return o[e]},this.setDefaultMsg=function(e){return angular.extend(l,e),r},this.getDefaultMsg=function(e){return l[e]},this.setErrorHTML=function(e){return e.constructor===Function?(r.getErrorHTML=e,r):void 0},this.getErrorHTML=function(e){return'<p class="validation-invalid">'+e+"</p>"},this.setSuccessHTML=function(e){return e.constructor===Function?(r.getSuccessHTML=e,r):void 0},this.getSuccessHTML=function(e){return'<p class="validation-valid">'+e+"</p>"},this.showSuccessMessage=!0,this.showErrorMessage=!0,this.checkValid=function(e){return void 0===e.$valid?!1:e&&e.$valid===!0},this.validate=function(e){var i=n.defer(),a=0;if(void 0===e)return console.error("This is not a regular Form name scope"),i.reject("This is not a regular Form name scope"),i.promise;if(e.validationId)t.$broadcast(e.$name+"submit-"+e.validationId,a++);else if(e.constructor===Array)for(var o in e)t.$broadcast(e[o].$name+"submit-"+e[o].validationId,a++);else for(var l in e)"$"!==l[0]&&e[l].hasOwnProperty("$dirty")&&t.$broadcast(l+"submit-"+e[l].validationId,a++);return i.promise.success=function(e){return i.promise.then(function(t){e(t)}),i.promise},i.promise.error=function(e){return i.promise.then(null,function(t){e(t)}),i.promise},s(function(){r.checkValid(e)?i.resolve("success"):i.reject("error")}),i.promise},this.validCallback=null,this.invalidCallback=null,this.reset=function(e){if(void 0===e)return void console.error("This is not a regular Form name scope");if(e.validationId)t.$broadcast(e.$name+"reset-"+e.validationId);else if(e.constructor===Array)for(var i in e)t.$broadcast(e[i].$name+"reset-"+e[i].validationId);else for(var n in e)"$"!==n[0]&&e[n].hasOwnProperty("$dirty")&&t.$broadcast(n+"reset-"+e[n].validationId)},this.$get=["$injector",function(e){return a(e),{setErrorHTML:this.setErrorHTML,getErrorHTML:this.getErrorHTML,setSuccessHTML:this.setSuccessHTML,getSuccessHTML:this.getSuccessHTML,setExpression:this.setExpression,getExpression:this.getExpression,setDefaultMsg:this.setDefaultMsg,getDefaultMsg:this.getDefaultMsg,showSuccessMessage:this.showSuccessMessage,showErrorMessage:this.showErrorMessage,checkValid:this.checkValid,validate:this.validate,validCallback:this.validCallback,invalidCallback:this.invalidCallback,reset:this.reset}}]})}.call(this),function(){angular.module("validation.directive",["validation.provider"]).directive("validator",["$injector",function(e){var t=e.get("$validation"),i=e.get("$q"),n=e.get("$timeout"),s=function(e,i,n,s,r){var a,o=i||t.getDefaultMsg(n).success;return a=s.messageId?angular.element(document.querySelector("#"+s.messageId)):e.next(),t.showSuccessMessage&&o?(a.html(t.getSuccessHTML(o)),a.css("display","")):a.css("display","none"),r.$setValidity(r.$name,!0),s.validCallback&&s.validCallback({message:o}),t.validCallback&&t.validCallback(e),!0},r=function(e,i,n,s,r){var a,o=i||t.getDefaultMsg(n).error;return a=s.messageId?angular.element(document.querySelector("#"+s.messageId)):e.next(),t.showErrorMessage&&o?(a.html(t.getErrorHTML(o)),a.css("display","")):a.css("display","none"),r.$setValidity(r.$name,!1),s.invalidCallback&&s.invalidCallback({message:o}),t.invalidCallback&&t.invalidCallback(e,o),!1},a={},o=function(e,n,a,l,c,u){var d=c.slice(0),v=d[0].trim(),g=v.indexOf("="),f=-1===g?v:v.substr(0,g),m=-1===g?null:v.substr(g+1),h=d.slice(1),$=f+"SuccessMessage",p=f+"ErrorMessage",M=t.getExpression(f),b={success:function(){return s(n,a[$],f,e,l),h.length?o(e,n,a,l,h,u):!0},error:function(){return r(n,a[p],f,e,l)}};return void 0===M?(console.error('You are using undefined validator "%s"',f),h.length?o(e,n,a,l,h,u):void 0):M.constructor===Function?i.all([t.getExpression(f)(u,e,n,a,m)]).then(function(e){return e&&e.length>0&&e[0]?b.success():b.error()},function(){return b.error()}):M.constructor===RegExp&&void 0!==u&&null!==u&&t.getExpression(f).test(u)?b.success():b.error()},l=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},c=function(){return l()+l()+l()+l()};return{restrict:"A",require:"ngModel",scope:{model:"=ngModel",initialValidity:"=initialValidity",validCallback:"&",invalidCallback:"&",messageId:"@"},link:function(e,t,i,s){var r,l=function(){},u=i.validator.split(","),d=s.validationId=c();"boolean"==typeof e.initialValidity&&(r=e.initialValidity),e.messageId||t.after("<span></span>"),s.$setValidity(s.$name,r),e.$on(s.$name+"reset-"+d,function(){l(),s.$setViewValue(""),s.$setPristine(),s.$setValidity(s.$name,void 0),s.$render(),e.messageId?angular.element(document.querySelector("#"+e.messageId)).html(""):t.next().html("")}),function(){return e.$on(s.$name+"submit-"+d,function(r,c){var d=s.$viewValue,v=!1;v=o(e,t,i,s,u,d),"submit"===i.validMethod&&(l(),l=e.$watch("model",function(n,r){n!==r&&((void 0===n||null===n)&&(n=""),v=o(e,t,i,s,u,n))}));var g=function(e){e?delete a[c]:(a[c]=t[0],n(function(){a[Math.min.apply(null,Object.keys(a))].focus()},0))};v.constructor===Object?v.then(g):g(v)}),"blur"===i.validMethod?void t.bind("blur",function(){var n=s.$viewValue;e.$apply(function(){o(e,t,i,s,u,n)})}):void("submit"!==i.validMethod&&"submit-only"!==i.validMethod&&e.$watch("model",function(n){if(s.$pristine&&s.$viewValue)s.$setViewValue(s.$viewValue);else if(s.$pristine)return void(e.messageId?angular.element(document.querySelector("#"+e.messageId)).html(""):t.next().html(""));o(e,t,i,s,u,n)}))}(),n(function(){i.$observe("noValidationMessage",function(i){var n;n=e.messageId?angular.element(document.querySelector("#"+e.messageId)):t.next(),"true"==i||i===!0?n.css("display","none"):("false"==i||i===!1)&&n.css("display","block")})})}}}]).directive("validationSubmit",["$injector",function(e){var t=e.get("$validation"),i=e.get("$timeout"),n=e.get("$parse");return{priority:1,require:"?ngClick",link:function(e,s,r){var a=n(r.validationSubmit)(e);i(function(){s.off("click"),s.on("click",function(i){i.preventDefault(),t.validate(a).success(function(){n(r.ngClick)(e)})})})}}}]).directive("validationReset",["$injector",function(e){var t=e.get("$validation"),i=e.get("$timeout"),n=e.get("$parse");return{link:function(e,s,r){var a=n(r.validationReset)(e);i(function(){s.on("click",function(e){e.preventDefault(),t.reset(a)})})}}}])}.call(this);